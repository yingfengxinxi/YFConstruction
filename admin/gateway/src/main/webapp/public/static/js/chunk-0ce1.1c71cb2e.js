(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ce1"],{"/SD7":function(e,t,a){"use strict";var s=a("hxdy");a.n(s).a},"6t+D":function(e,t,a){"use strict";var s=a("j1Vm");a.n(s).a},DNkW:function(e,t,a){var s=a("93I4"),r=Math.floor;e.exports=function(e){return!s(e)&&isFinite(e)&&r(e)===e}},c1YF:function(e,t,a){"use strict";a.r(t);var s=a("P2sY"),r=a.n(s),i=a("14Xm"),n=a.n(i),o=a("D3Ub"),c=a.n(o),l=a("ql3t"),u=a.n(l),p=a("4peS"),d=a.n(p),m=a("FXUk"),v={name:"Update",components:{Reminder:a("jzeO").a},data:function(){return{isClick:!1,isCanUpdate:!1,isLogin:!1,dialogVisible:!1,dialogVisibleH:!1,loginForm:{username:"",password:""},loginRules:{username:[{required:!0,message:"请输入悟空账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},userData:{},isCheckUpdate:!1,isNewest:!1,checkLoading:!1,version:"",serverVersion:"",isCustom:-1,backupType:1,databaseList:[],database:"",databaseRules:{host:[{required:!0,message:"请输入数据库地址",trigger:"blur"}],port:[{validator:function(e,t,a){if(!t)return a(new Error("请输入数据库端口号"));setTimeout(function(){u()(t)?t>65535||t<=0?a(new Error("请输入0~65535之间的端口号")):a():a(new Error("请输入数字值"))},1e3)},trigger:"blur"}],databaseName:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],DBUsername:[{required:!0,message:"请输入数据库账号",trigger:"blur"}],DBPassword:[{required:!0,message:"请输入数据库密码",trigger:"blur"}]},customDatabase:{host:"",port:"",databaseName:"",DBUsername:"",DBPassword:""},backLoading:!1,isBackSuccess:!1,sql:"",backType:1,updateLoading:!1,progressTooltip:"",progress:0}},created:function(){var e,t=(e=c()(n.a.mark(function e(){var t,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.b)();case 2:t=e.sent,s=t.data,a.checkIsNewest(s.version,s.serverVersion),a.checkLoading=!1,a.version=s.version,a.serverVersion=s.serverVersion,a.isCheckUpdate=!0;case 9:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)}),a=this;t()},methods:{loginHandle:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a={username:t.loginForm.username,password:t.loginForm.password};Object(m.e)(a).then(function(e){var a=e.data;0===e.code&&(t.userData=a,t.dialogVisible=!1,t.isLogin=!0,r()(t.userData,t.loginForm))}).catch(function(){})})},logoutHandle:function(){this.isLogin=!1,this.loginForm.username="",this.loginForm.password=""},checkHandle:function(){var e=this;return c()(n.a.mark(function t(){var a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.checkLoading=!0,t.next=3,Object(m.b)();case 3:a=t.sent,s=a.data,e.isNewest=e.checkIsNewest(s.version,s.serverVersion),e.checkLoading=!1,e.version=s.version,e.serverVersion=s.serverVersion,e.isCheckUpdate=!0,e.isClick=!0;case 11:case"end":return t.stop()}},t,e)}))()},checkIsNewest:function(e,t){return!((e=a(e))>(t=a(t)));function a(e){for(var t=(e=e.toString()).split("."),a=["","0","00","000","0000"].reverse(),s=0;s<t.length;s++){var r=t[s].length;t[s]=a[r]+t[s]}return t.join("")}},queryDatabaseHandle:function(){var e=this;return c()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.isCustom=1,t.next=3,Object(m.c)();case 3:a=t.sent,e.databaseList=a.data,e.isShowDatabase=0===a.code;case 6:case"end":return t.stop()}},t,e)}))()},submitForm:function(){var e=this;this.$refs.databaseForm.validate(function(t){if(!t)return!1;e.dataBackHandle()})},dataBackHandle:function(){var e=this;return c()(n.a.mark(function t(){var a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLogin){t.next=3;break}return e.$message({showClose:!0,message:"请登陆悟空账号",type:"warning"}),t.abrupt("return");case 3:if(!e.isCustom||e.database){t.next=6;break}return e.$message({showClose:!0,message:"请选择要备份的数据库",type:"warning"}),t.abrupt("return");case 6:return e.backLoading=!0,a=e.isCustom?{backupType:e.backupType,databaseName:e.database,username:e.loginForm.username,password:e.loginForm.password,isCustom:e.isCustom}:r()(e.customDatabase,e.loginForm),t.next=10,Object(m.a)(a);case 10:s=t.sent,e.backLoading=!1,0===s.code&&(e.isBackSuccess=!0,e.sql=s.data,e.isCanUpdate=!0);case 13:case"end":return t.stop()}},t,e)}))()},updateHandle:function(){var e=this;return c()(n.a.mark(function t(){var a,s,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLogin){t.next=3;break}return e.$message({message:"未进行登陆",type:"warning"}),t.abrupt("return");case 3:if(e.isBackSuccess){t.next=6;break}return e.$message({message:"未进行数据备份",type:"warning"}),t.abrupt("return");case 6:return e.updateLoading=!0,a=e.isCustom?{backupType:e.backupType,databaseName:e.database,username:e.loginForm.username,password:e.loginForm.password,isCustom:e.isCustom}:r()(e.customDatabase,e.loginForm),t.next=10,Object(m.d)(a);case 10:0===t.sent.code&&(e.progressTooltip="更新准备中",s=e,i=setInterval(function(){var e;(e=c()(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.f)();case 2:t=e.sent,e.t0=t.data,e.next=5===e.t0?6:15===e.t0?8:25===e.t0?10:50===e.t0?12:70===e.t0?14:100===e.t0?16:20;break;case 6:return s.progressTooltip="获取更新信息中",e.abrupt("break",24);case 8:return s.progressTooltip="备份数据库中",e.abrupt("break",24);case 10:return s.progressTooltip="备份文件中",e.abrupt("break",24);case 12:return s.progressTooltip="停止受影响的服务中",e.abrupt("break",24);case 14:return s.progressTooltip="执行升级中",e.abrupt("break",24);case 16:case 20:return s.progressTooltip="升级已完成",setTimeout(function(){s.updateLoading=!1,s.isNewest=!0},500),clearInterval(i),e.abrupt("break",24);case 24:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})()},3e3));case 12:case"end":return t.stop()}},t,e)}))()},handleSizeChange:function(e){d.a.set("crmPageSizes",e),this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e}}},b=(a("6t+D"),a("KHd+")),f=Object(b.a)(v,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"crm-update"},[e._m(0),e._v(" "),a("reminder",{staticClass:"warning-box",attrs:{content:"更新前，您需要备份您的数据，防止数据丢失。"}}),e._v(" "),e.isLogin?a("div",{staticClass:"login-box"},[a("div",{staticClass:"face"},[e.userData.img?a("img",{attrs:{src:e.userData.img,alt:""}}):a("span",[e._v(e._s(e.userData.name))])]),e._v(" "),a("div",{staticClass:"info"},[a("span",{staticClass:"name"},[e._v(e._s(e.userData.name))]),e._v(" "),a("span",{staticClass:"title"},[e._v(e._s(e.userData.title))]),e._v(" "),a("p",[e._v(e._s(e.userData.companyName))]),e._v(" "),a("p",[a("i",{staticClass:"el-icon-mobile-phone"}),e._v("\n        "+e._s(e.userData.mobile)+"\n      ")]),e._v(" "),a("p",[a("i",{staticClass:"wk wk-icon-email-outline"}),e._v("\n        "+e._s(e.userData.email)+"\n      ")])]),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.logoutHandle}},[e._v("注销")])],1)]):a("div",{staticClass:"login-box"},[a("div",{staticClass:"face"},[e._v("登录")]),e._v(" "),a("div",{staticClass:"info"},[a("div",{staticClass:"login-box-title"},[a("span",{on:{click:function(t){e.dialogVisible=!0}}},[e._v("请点击登")]),e._v(" "),a("p",[e._v("更新前需要先登录悟空账号")])])]),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.dialogVisible=!0}}},[e._v("登录")])],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.checkLoading,expression:"checkLoading"}],staticClass:"last-time"},[a("el-button",{attrs:{disabled:e.isClick,type:"primary",plain:""},on:{click:e.checkHandle}},[e._v("检查更新")])],1),e._v(" "),e.isCheckUpdate?a("div",{},[e.isNewest?a("div",{staticClass:"version"},[a("p",{staticClass:"text"},[e._v("您当前是最新版本")]),e._v("\n      当前版本："+e._s(e.version)+"\n    ")]):a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.updateLoading,expression:"updateLoading"}],staticClass:"version",attrs:{"element-loading-text":e.progressTooltip,"element-loading-background":"#fff"}},[a("p",{staticClass:"text"},[e._v("有新的版本可升级")]),e._v("\n      当前版本："+e._s(e.serverVersion)+"，您可以升级到\n      "),a("span",[e._v(e._s(e.version))]),e._v(" "),a("div",{staticClass:"update-wrap"},[a("el-badge",{staticClass:"update-badge",attrs:{value:1}},[a("el-button",{attrs:{type:e.isCanUpdate?"primary":"info"},on:{click:e.updateHandle}},[e._v("现在更新")])],1)],1)])]):e._e(),e._v(" "),a("div",{staticClass:"data-back"},[a("p",{staticClass:"text"},[e._v("数据备份")]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.backLoading,expression:"backLoading"}],staticClass:"box",attrs:{"element-loading-text":"努力备份中"}},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.queryDatabaseHandle}},[e._v("查询数据库")]),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.isCustom=0}}},[e._v("自定义数据库")]),e._v(" "),1===e.isCustom?a("div",{staticClass:"database-wrap"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.database,callback:function(t){e.database=t},expression:"database"}},e._l(e.databaseList,function(e,t){return a("el-option",{key:t,attrs:{value:e}})})),e._v(" "),a("p",{staticClass:"way"},[e._v("\n          选择备份方式：\n          "),a("el-radio",{attrs:{label:1},model:{value:e.backupType,callback:function(t){e.backupType=t},expression:"backupType"}},[e._v("本地备份")])],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.dataBackHandle}},[e._v("开始备份")])],1):e._e(),e._v(" "),0===e.isCustom?a("el-form",{ref:"databaseForm",staticClass:"custom1",attrs:{model:e.customDatabase,rules:e.databaseRules,"status-icon":""}},[a("el-form-item",{attrs:{prop:"host"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入数据库地址"},model:{value:e.customDatabase.host,callback:function(t){e.$set(e.customDatabase,"host",t)},expression:"customDatabase.host"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"port"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入数据库端口号"},model:{value:e.customDatabase.port,callback:function(t){e.$set(e.customDatabase,"port",e._n(t))},expression:"customDatabase.port"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"databaseName"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入数据库名称"},model:{value:e.customDatabase.databaseName,callback:function(t){e.$set(e.customDatabase,"databaseName",t)},expression:"customDatabase.databaseName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"DBUsername"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入数据库用户名"},model:{value:e.customDatabase.DBUsername,callback:function(t){e.$set(e.customDatabase,"DBUsername",t)},expression:"customDatabase.DBUsername"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"DBPassword"}},[a("el-input",{attrs:{type:"password",autocomplete:"off",placeholder:"请输入数据库密码"},model:{value:e.customDatabase.DBPassword,callback:function(t){e.$set(e.customDatabase,"DBPassword",t)},expression:"customDatabase.DBPassword"}})],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("开始备份")])],1):e._e(),e._v(" "),e.isBackSuccess?a("div",{staticClass:"back-success"},[e._v("备份成功！文件路径："+e._s(e.sql))]):e._e(),e._v(" "),e._m(1)],1)]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"登录悟空账号",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n      登录悟空账号\n      "),a("p",{staticClass:"description"},[e._v("您可以登录悟空账号来进行一键升级")])]),e._v(" "),a("el-form",{ref:"loginRef",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"label-width":"80px","label-position":"top"}},[a("div",{staticClass:"form-item"},[a("el-form-item",{attrs:{prop:"username"}},[a("i",{staticClass:"wk wk-mobile"}),e._v("账号\n          "),a("el-input",{attrs:{placeholder:"请输入您的悟空账号"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1)],1),e._v(" "),a("div",{staticClass:"form-item password"},[a("el-form-item",{attrs:{prop:"password"}},[a("i",{staticClass:"wk wk-lock"}),e._v("密码\n          "),a("el-input",{attrs:{type:"password",placeholder:"请输入您的悟空账号的密码"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1)],1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.loginHandle("loginRef")}}},[e._v("确认登录")])],1)],1)],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title-wrap"},[t("i",{staticClass:"el-icon-setting"}),this._v(" "),t("div",[t("p",{staticClass:"title"},[this._v("系统更新")]),this._v(" "),t("p",{staticClass:"description"},[this._v("你可以随时检查使用系统是否是最新版本，并进行一键升级")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"explain"},[t("p",[this._v("备份说明:")]),this._v(" "),t("p",[this._v("1、本地备份将只备份SQL，并被备份到同级目录下")]),this._v(" "),t("p",[this._v("2、云端备份数据将备份到云端，在个人中心可以查看备份记录，下载备份数据")])])}],!1,null,"71c4e273",null);f.options.__file="index.vue";t.default=f.exports},h5AQ:function(e,t,a){a("hRZT"),e.exports=a("WEpk").Number.isInteger},hRZT:function(e,t,a){var s=a("Y7ZC");s(s.S,"Number",{isInteger:a("DNkW")})},hxdy:function(e,t,a){},j1Vm:function(e,t,a){},jzeO:function(e,t,a){"use strict";var s={name:"Reminder",components:{},props:{closeShow:{type:Boolean,default:!1},content:{type:String,default:"内容"},fontSize:{type:String,default:"13"}},data:function(){return{}},computed:{},mounted:function(){},destroyed:function(){},methods:{close:function(){this.$emit("close")}}},r=(a("/SD7"),a("KHd+")),i=Object(r.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{staticClass:"reminder-wrapper"},[a("flexbox",{staticClass:"reminder-body",attrs:{align:"stretch"}},[a("i",{staticClass:"wk wk-warning reminder-icon"}),e._v(" "),a("div",{staticClass:"reminder-content",style:{"font-size":e.fontSize+"px"},domProps:{innerHTML:e._s(e.content)}}),e._v(" "),e._t("default"),e._v(" "),e.closeShow?a("i",{staticClass:"el-icon-close close",on:{click:e.close}}):e._e()],2)],1)},[],!1,null,"d9a726d6",null);i.options.__file="Reminder.vue";t.a=i.exports},ql3t:function(e,t,a){e.exports={default:a("h5AQ"),__esModule:!0}}}]);