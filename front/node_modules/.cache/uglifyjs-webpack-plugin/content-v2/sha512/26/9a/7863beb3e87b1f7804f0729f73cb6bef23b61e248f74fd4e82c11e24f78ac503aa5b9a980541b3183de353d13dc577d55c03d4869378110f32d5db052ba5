{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-0aaf\"],{\"2X1c\":function(t,e,a){\"use strict\";a.d(e,\"b\",function(){return i}),a.d(e,\"a\",function(){return n}),a.d(e,\"c\",function(){return o});var s=a(\"t3Un\");function i(t){return Object(s.a)({url:\"workTask/queryTrashList\",method:\"post\",data:t})}function n(t){return Object(s.a)({url:\"workTask/deleteTask/\"+t,method:\"post\"})}function o(t){return Object(s.a)({url:\"workTask/restore/\"+t,method:\"post\"})}},\"936R\":function(t,e,a){\"use strict\";var s=a(\"Rw8k\");a.n(s).a},BLKJ:function(t,e,a){\"use strict\";var s=a(\"dow+\");a.n(s).a},Flj7:function(t,e,a){\"use strict\";a.d(e,\"f\",function(){return i}),a.d(e,\"h\",function(){return n}),a.d(e,\"g\",function(){return o}),a.d(e,\"o\",function(){return c}),a.d(e,\"p\",function(){return r}),a.d(e,\"e\",function(){return l}),a.d(e,\"r\",function(){return d}),a.d(e,\"i\",function(){return u}),a.d(e,\"a\",function(){return h}),a.d(e,\"k\",function(){return k}),a.d(e,\"q\",function(){return m}),a.d(e,\"j\",function(){return p}),a.d(e,\"m\",function(){return f}),a.d(e,\"l\",function(){return b}),a.d(e,\"n\",function(){return v}),a.d(e,\"b\",function(){return g}),a.d(e,\"d\",function(){return _}),a.d(e,\"c\",function(){return T});var s=a(\"t3Un\");function i(t){return Object(s.a)({url:\"workTaskClass/saveWorkTaskClass\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function n(t){return Object(s.a)({url:\"workTask/deleteWorkTask/\"+t,method:\"post\"})}function o(t){return Object(s.a)({url:\"workTaskClass/updateWorkTaskClass\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function c(t){return Object(s.a)({url:\"workTask/saveWorkTask\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function r(t){return Object(s.a)({url:\"workTask/setWorkTaskStatus\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function l(t){return Object(s.a)({url:\"workTask/setWorkChildTaskStatus\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function d(t){return Object(s.a)({url:\"workTask/setWorkTaskTitle\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function u(t){return Object(s.a)({url:\"workTask/setWorkTaskDescription\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function h(t){return Object(s.a)({url:\"workTaskMilestone/setTaskMilestone\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function k(t){return Object(s.a)({url:\"workTask/setWorkTaskMainUser\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function m(t){return Object(s.a)({url:\"workTask/setWorkTaskTime\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function p(t){return Object(s.a)({url:\"workTask/setWorkTaskLabel\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function f(t){return Object(s.a)({url:\"workTask/setWorkTaskOwnerUser\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function b(t){return Object(s.a)({url:\"workTask/deleteWorkTaskOwnerUser\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function v(t){return Object(s.a)({url:\"workTask/setWorkTaskPriority\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function g(t){return Object(s.a)({url:\"workTask/addWorkChildTask\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function _(t){return Object(s.a)({url:\"workTask/updateWorkChildTask\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function T(t){return Object(s.a)({url:\"workTask/deleteWorkChildTask/\"+t,method:\"post\"})}},HslM:function(t,e,a){\"use strict\";a.r(e);var s=a(\"FyfS\"),i=a.n(s),n=a(\"Vf/o\"),o=a(\"PAIM\"),c=a(\"zsVz\"),r=a(\"Ajln\"),l=a(\"Flj7\"),d={components:{NewTag:n.default,EditTag:o.default},props:{taskData:{type:Object,default:function(){return{}}},placement:String},data:function(){return{tagShow:!1,tagContent:0,tagSearch:\"\",tagList:[],newTagTitle:\"\",newTagInput:\"\",bgColorProps:\"\",editTagId:\"\"}},computed:{showTagList:function(){for(var t=[],e=0;e<this.tagList.length;e++){var a=this.tagList[e];a.name.indexOf(this.tagSearch)>-1&&t.push(a)}return t},popoverWidth:function(){return 1==this.tagContent?330:2==this.tagContent?400:220},workId:function(){return this.taskData.workId}},watch:{},mounted:function(){},methods:{createTagClick:function(){this.newTagTitle=\"创建新标签\",this.newTagInput=\"\",this.tagContent=1},editTagClick:function(t){this.editTagId=t.labelId,this.newTagTitle=\"编辑标签\",this.tagContent=1,this.bgColorProps=t.color,this.newTagInput=t.name},managementTag:function(){this.tagContent=2},tagSelectClick:function(t,e){var a=this;if(t.check)Object(c.f)({taskId:this.taskData.taskId,labelId:t.labelId}).then(function(e){t.check=!1,a.updateDetailList(t,\"delete\")}).catch(function(){t.check=!0});else{var s=this.tagList.filter(function(t){return t.check}).concat(t);Object(l.j)({taskId:this.taskData.taskId,labelId:s.map(function(t){return t.labelId}).join(\",\")}).then(function(e){t.check=!0;var s=[];a.tagList.forEach(function(t){t.check&&(t.labelName=t.name,s.push(t))}),a.taskData.labelList=s}).catch(function(){t.check=!1})}},updateDetailList:function(t,e){for(var a=-1,s=0;s<this.taskData.labelList.length;s++){if(this.taskData.labelList[s].labelId==t.labelId){a=s;break}}a>=0&&(\"delete\"==e?this.taskData.labelList.splice(a,1):this.taskData.labelList.splice(a,1,t))},changeColor:function(t){this.bgColorProps=t},tagClose:function(){this.tagShow=!1},tagCreateSubmit:function(t,e){var a=this;\"创建新标签\"==this.newTagTitle?Object(r.e)({name:t,color:e}).then(function(t){a.getTagList(),a.back(),a.$message.success(\"创建成功\")}):Object(r.f)({name:t,labelId:this.editTagId,color:e}).then(function(s){var n=!0,o=!1,c=void 0;try{for(var r,l=i()(a.tagList);!(n=(r=l.next()).done);n=!0){var d=r.value;d.labelId==a.editTagId&&(d.name=t,d.color=e,d.labelName=d.name,a.updateDetailList(d,\"update\"))}}catch(t){o=!0,c=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw c}}a.tagContent=2})},tagCancel:function(){\"创建新标签\"==this.newTagTitle?(this.tagClose(),this.$message.info(\"已取消创建\")):this.tagContent=2},back:function(){1==this.tagContent?this.tagContent=\"创建新标签\"==this.newTagTitle?0:2:2==this.tagContent&&(this.tagContent=0)},deleteBtn:function(t){var e=this;this.$confirm(\"确定删除?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){Object(r.a)({labelId:t.labelId}).then(function(a){for(var s in e.tagList)if(e.tagList[s].labelId==t.labelId){e.tagList.splice(s,1);break}e.$message({type:\"success\",message:\"删除成功!\"}),e.tagShow=!0}).catch(function(){e.tagShow=!0})}).catch(function(){e.$message({type:\"info\",message:\"已取消删除\"}),e.tagShow=!0})},getTagList:function(){var t=this;Object(r.c)().then(function(e){var a=e.data||[],s=(t.taskData.labelList||[]).map(function(t){return t.labelId}),n=!0,o=!1,c=void 0;try{for(var r,l=i()(a);!(n=(r=l.next()).done);n=!0){var d=r.value;d.check=s.includes(d.labelId)}}catch(t){o=!0,c=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw c}}t.tagList=a}).catch(function(){})},referenceFun:function(){this.tagContent=0,this.tagList&&!this.tagList.length&&this.getTagList()}}},u=(a(\"BLKJ\"),a(\"KHd+\")),h=Object(u.a)(d,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"el-popover\",{attrs:{placement:t.placement,width:t.popoverWidth,trigger:\"click\"},model:{value:t.tagShow,callback:function(e){t.tagShow=e},expression:\"tagShow\"}},[0==t.tagContent?a(\"div\",{staticClass:\"tag-popover-box\"},[a(\"div\",{staticClass:\"tag-top\"},[a(\"span\",[t._v(\"选择标签\")]),t._v(\" \"),a(\"span\",{staticClass:\"el-icon-close rt cursor-pointer\",on:{click:function(e){t.tagShow=!1}}})]),t._v(\" \"),a(\"el-input\",{attrs:{placeholder:\"搜索标签\",\"prefix-icon\":\"el-icon-search\",size:\"small\"},model:{value:t.tagSearch,callback:function(e){t.tagSearch=e},expression:\"tagSearch\"}}),t._v(\" \"),a(\"div\",{staticClass:\"tag-content\"},t._l(t.showTagList,function(e,s){return a(\"div\",{key:s,staticClass:\"tag-list\",on:{click:function(a){t.tagSelectClick(e,s)}}},[a(\"i\",{staticClass:\"wukong wukong-black-label\",style:{color:e.color}}),t._v(\" \"),a(\"span\",{staticClass:\"item-label\"},[t._v(t._s(e.name))]),t._v(\" \"),e.check?a(\"span\",{staticClass:\"el-icon-check rt\"}):t._e()])})),t._v(\" \"),a(\"div\",{staticClass:\"tag-footer\"},[a(\"p\",{staticClass:\"footer-row cursor-pointer\",on:{click:t.createTagClick}},[a(\"span\",{staticClass:\"el-icon-plus\"}),t._v(\" \"),a(\"span\",[t._v(\"创建新标签\")])]),t._v(\" \"),a(\"p\",{staticClass:\"footer-row cursor-pointer\",on:{click:t.managementTag}},[a(\"span\",{staticClass:\"el-icon-setting\"}),t._v(\" \"),a(\"span\",[t._v(\"标签管理\")])])])],1):1==t.tagContent||3==t.tagContent?a(\"new-tag\",{attrs:{\"new-tag-title\":t.newTagTitle,\"new-tag-input\":t.newTagInput,\"bg-color-props\":t.bgColorProps},on:{changeColor:t.changeColor,close:t.tagClose,tagCreateSubmit:t.tagCreateSubmit,tagCancel:t.tagCancel,back:t.back}}):2==t.tagContent?a(\"editTag\",{attrs:{\"edit-tag-list\":t.tagList},on:{back:t.back,close:t.tagClose,editBtn:t.editTagClick,deleteBtn:t.deleteBtn}}):t._e(),t._v(\" \"),a(\"span\",{attrs:{slot:\"reference\"},on:{click:t.referenceFun},slot:\"reference\"},[t._t(\"editIndex\")],2)],1)},[],!1,null,\"6fcf0e94\",null);h.options.__file=\"TagIndex.vue\";e.default=h.exports},OWIW:function(t,e,a){\"use strict\";var s=a(\"gWfY\");a.n(s).a},PAIM:function(t,e,a){\"use strict\";a.r(e);var s={props:{editTagList:Array},data:function(){return{searchInput:\"\"}},computed:{list:function(){var t=this;return this.editTagList.filter(function(e){return e.name.indexOf(t.searchInput)>-1})}},watch:{},methods:{back:function(){this.$emit(\"back\")},close:function(){this.$emit(\"close\")},deleteBtn:function(t){this.$emit(\"deleteBtn\",t)},editBtn:function(t){this.$emit(\"editBtn\",t)}}},i=(a(\"936R\"),a(\"KHd+\")),n=Object(i.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"edit-tag-dialog\"},[a(\"div\",{staticClass:\"title\"},[a(\"span\",{staticClass:\"el-icon-arrow-left\",on:{click:t.back}}),t._v(\" \"),a(\"span\",[t._v(\"标签管理\")]),t._v(\" \"),a(\"span\",{staticClass:\"el-icon-close rt\",on:{click:t.close}})]),t._v(\" \"),a(\"div\",{staticClass:\"search\"},[a(\"el-input\",{attrs:{maxlength:10,size:\"mini\",placeholder:\"输入标签名，最多十个字符\"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:\"searchInput\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"content\"},t._l(t.list,function(e,s){return a(\"div\",{key:s,staticClass:\"tag-list\"},[a(\"span\",{staticClass:\"tag-name\",style:{background:e.color?e.color:\"#ccc\"}},[t._v(\"\\n        \"+t._s(e.name.length>10?e.name.substring(0,10)+\"...\":e.name)+\"\\n      \")]),t._v(\" \"),a(\"div\",{staticClass:\"rt\"},[a(\"span\",{staticClass:\"el-icon-edit\",on:{click:function(a){t.editBtn(e)}}}),t._v(\" \"),a(\"span\",{staticClass:\"el-icon-delete\",on:{click:function(a){t.deleteBtn(e)}}})])])}))])},[],!1,null,\"d1e776f2\",null);n.options.__file=\"EditTag.vue\";e.default=n.exports},Rw8k:function(t,e,a){},\"Vf/o\":function(t,e,a){\"use strict\";a.r(e);var s={props:{newTagTitle:String,newTagInput:String,bgColorProps:String},data:function(){return{colorList:[\"#53D397\",\"#20C1BD\",\"#58DADA\",\"#0FC9E7\",\"#3498DB\",\"#4586FF\",\"#8983F3\",\"#AEA1EA\",\"#FF6699\",\"#F24D70\",\"#FF6F6F\"],input:this.newTagInput,showBgColor:\"\"}},watch:{bgColorProps:function(t){this.showBgColor=t||\"#53D397\"}},mounted:function(){this.showBgColor=this.bgColorProps||\"#53D397\"},methods:{back:function(){this.$emit(\"back\")},close:function(){this.$emit(\"close\")},changeColor:function(t){this.$emit(\"changeColor\",t)},tagCreateSubmit:function(){this.$emit(\"tagCreateSubmit\",this.input,this.showBgColor)},tagCancel:function(){this.$emit(\"tagCancel\")}}},i=(a(\"OWIW\"),a(\"KHd+\")),n=Object(i.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"new-tag-dialog\"},[a(\"div\",{staticClass:\"title\"},[a(\"span\",{staticClass:\"el-icon-arrow-left\",on:{click:t.back}}),t._v(\" \"),a(\"span\",[t._v(t._s(t.newTagTitle))]),t._v(\" \"),a(\"span\",{staticClass:\"el-icon-close rt\",on:{click:t.close}})]),t._v(\" \"),a(\"div\",{staticClass:\"search\"},[a(\"el-input\",{attrs:{maxlength:10,size:\"mini\",placeholder:\"输入标签名，最多十个字符\"},model:{value:t.input,callback:function(e){t.input=e},expression:\"input\"}}),t._v(\" \"),a(\"span\",{staticClass:\"checked-color\",style:{background:t.showBgColor}})],1),t._v(\" \"),a(\"div\",{staticClass:\"color-box\"},t._l(t.colorList,function(e,s){return a(\"span\",{key:s,style:{background:e},on:{click:function(a){t.changeColor(e)}}})})),t._v(\" \"),a(\"div\",{staticClass:\"footer\"},[a(\"el-button\",{directives:[{name:\"debounce\",rawName:\"v-debounce\",value:t.tagCreateSubmit,expression:\"tagCreateSubmit\"}],attrs:{type:\"primary\",size:\"medium\"}},[t._v(\"保存\")]),t._v(\" \"),a(\"el-button\",{attrs:{size:\"medium\"},on:{click:t.tagCancel}},[t._v(\"取消\")])],1)])},[],!1,null,\"2756a05c\",null);n.options.__file=\"NewTag.vue\";e.default=n.exports},cEue:function(t,e,a){t.exports=a.p+\"static/img/delete_task.96cc063.png\"},cFwc:function(t,e,a){},\"dow+\":function(t,e,a){},gWfY:function(t,e,a){},hSIE:function(t,e,a){\"use strict\";a.d(e,\"d\",function(){return i}),a.d(e,\"f\",function(){return n}),a.d(e,\"b\",function(){return o}),a.d(e,\"c\",function(){return c}),a.d(e,\"e\",function(){return r}),a.d(e,\"a\",function(){return l});var s=a(\"t3Un\");function i(t){return Object(s.a)({url:\"workTask/myTask\",method:\"post\",data:t})}function n(t){return Object(s.a)({url:\"workTask/updateTop\",method:\"post\",data:t,headers:{\"Content-Type\":\"application/json;charset=UTF-8\"}})}function o(t){return Object(s.a)({url:\"work/work/queryWorkNameList\",method:\"post\",data:t})}function c(t){return Object(s.a)({url:\"workTask/archiveByTaskId/\"+t,method:\"post\"})}function r(t){return Object(s.a)({url:\"work/work/activation/\"+t,method:\"post\"})}function l(t){return Object(s.a)({url:\"workTask/workBenchTaskExport\",method:\"post\",data:t,responseType:\"blob\"})}},kK4T:function(t,e,a){\"use strict\";a.r(e),e.default={data:function(){return{priorityList:[{id:3,label:\"高\",color:\"#F95A5A\"},{id:2,label:\"中\",color:\"#F7AD3D\"},{id:1,label:\"低\",color:\"#67C23A\"},{id:0,label:\"无\",color:\"#D8D8D8\"}]}},methods:{getPriorityColor:function(t){return 1==t?{color:\"#67C23A\",label:\"低\"}:2==t?{color:\"#F7AD3D\",label:\"中\"}:3==t?{color:\"#F95A5A\",label:\"高\"}:{color:\"transparent\",label:\"无\"}}}}},pKm3:function(t,e,a){\"use strict\";a.r(e);var s=a(\"FyfS\"),i=a.n(s),n=a(\"QbLZ\"),o=a.n(n),c=a(\"Ew9n\"),r=a(\"Xjjk\"),l=a.n(r),d=a(\"hSIE\"),u=a(\"zsVz\"),h=a(\"Ir+r\"),k=a(\"Flj7\"),m=a(\"LWkM\"),p=a(\"2X1c\"),f=a(\"U8n8\"),b=a(\"HslM\"),v=a(\"z5u8\"),g=a(\"u+Mw\"),_=a(\"EBQf\"),T=a(\"8GhS\"),C=a(\"hwzM\"),D=a(\"L2JU\"),w=a(\"z7oh\"),x=a(\"dPzk\"),y=a(\"wd/R\"),I=a.n(y),L=a(\"7Qib\"),j=a(\"kK4T\"),U={name:\"TaskDetail\",components:{SlideView:c.a,MembersDep:f.a,Emoji:g.a,RelatedBusiness:_.a,TagIndex:b.default,CRMFullScreenDetail:function(){return Promise.all([a.e(\"chunk-63bb\"),a.e(\"chunk-7029\"),a.e(\"chunk-6435\"),a.e(\"chunk-9dc6\"),a.e(\"chunk-8a41\")]).then(a.bind(null,\"3z7q\"))},SubTask:v.default,FileCell:C.default,XhUserCell:T.p,CommentList:w.a,ReplyComment:x.a},mixins:[j.default],props:{id:[String,Number],isTrash:Boolean,detailIndex:Number,detailSection:Number,noListenerClass:{type:Array,default:function(){return[\"el-table__body\"]}}},data:function(){var t=this;return{loading:null,canShowDetail:!0,priorityVisible:!1,startTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.stopTime)&&I()(e).isAfter(t.taskData.stopTime)}},stopTimeOptions:{disabledDate:function(e){return!(!t.taskData||!t.taskData.startTime)&&I()(e).isBefore(t.taskData.startTime)}},addSubtasks:!0,nameVinput:!1,taskDataName:\"\",addDescriptionShow:!1,addDescriptionTextarea:\"\",subTaskDoneNum:0,addComments:!1,allData:{},commentsLoading:!1,relatedID:\"\",relatedCRMType:\"\",showRelatedDetail:!1,subTaskID:null,taskData:null,taskMilestone:\"1\",activityList:[],fileList:[],replyList:[]}},computed:o()({},Object(D.b)([\"userInfo\"]),{priority:function(){return 0!=this.taskData.priority&&this.taskData.priority?this.getPriorityColor(this.taskData.priority):this.priorityList[3]},isArchive:function(){return 1==this.taskData.isArchive&&1!=this.taskData.ishidden},isRecycle:function(){return 1==this.taskData.ishidden},showArchiveBtn:function(){return this.workId&&!this.isArchive&&!this.isRecycle},subTaskProgress:function(){return 0==this.subTaskDoneNum?0:parseInt(this.subTaskDoneNum/this.taskData.childTask.length*100)},ownerListRequest:function(){return this.workId?m.t:null},ownerListParams:function(){return this.workId?{workId:this.workId}:null},workId:function(){return this.taskData.workId},labelList:function(){return this.taskData&&this.taskData.labelList||[]}}),watch:{id:function(t){this.initInfo(),this.getDetail(),this.getCommentList(),this.getActivityList()},labelList:function(t,e){e&&this.$emit(\"on-handle\",{type:\"change-label\",value:t,index:this.detailIndex,section:this.detailSection})},addDescriptionTextarea:function(t){this.$refs.sideView.isEditClose=!!(t&&t.length>0)}},mounted:function(){},beforeDestroy:function(){},methods:{viewAfterEnter:function(){this.id&&(this.getDetail(),this.getCommentList(),this.getActivityList())},initInfo:function(){this.taskData=null,this.subTaskDoneNum=0,this.addDescriptionShow=!1,this.priorityVisible=!1,this.addSubtasks=!0,this.nameVinput=!1,this.addDescriptionTextarea=\"\",this.addComments=!1,this.allData={business:[],contacts:[],contract:[],customer:[]},this.relatedID=\"\",this.showRelatedDetail=!1,this.activityList=[],this.fileList=[],this.replyList=[]},getDetail:function(){var t=this;this.loading=!0,(this.isTrash?u.b:u.a)({taskId:this.id}).then(function(e){var a=e.data;if(a.checked=5==a.status,a.childTask){var s=!0,n=!1,o=void 0;try{for(var c,r=i()(a.childTask);!(s=(c=r.next()).done);s=!0){var l=c.value;5==l.status?(l.checked=!0,t.subTaskDoneNum++):l.checked=!1}}catch(t){n=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(n)throw o}}}t.fileList=e.data.file,t.allData={business:(a.businessList||[]).map(function(t){return t.id&&(t.businessId=t.id),t}),contacts:(a.contactsList||[]).map(function(t){return t.id&&(t.contactsId=t.id),t}),contract:(a.contractList||[]).map(function(t){return t.id&&(t.contractId=t.id),t}),customer:(a.customerList||[]).map(function(t){return t.id&&(t.customerId=t.id),t})},t.taskData=a,t.loading=!1}).catch(function(e){t.loading=!1,e&&\"没有权限\"==e.msg?t.canShowDetail=!1:t.closeBtn()})},getActivityList:function(){var t=this;Object(u.d)({taskId:this.id}).then(function(e){t.activityList=e.data}).catch(function(){})},getCommentList:function(){var t=this;Object(h.b)({typeId:this.id,type:1}).then(function(e){t.replyList=e.data}).catch(function(){})},completeMainTask:function(t){var e=this;this.taskData.checked=t,Object(k.p)({taskId:this.id,status:this.taskData.checked?5:1}).then(function(a){e.$emit(\"on-handle\",{type:\"title-check\",value:t,index:e.detailIndex,section:e.detailSection})}).catch(function(){e.taskData.checked=!e.taskData.checked})},editTaskName:function(){this.getPermission(\"setTaskTitle\")&&(this.nameVinput=!0,this.taskDataName=this.taskData.name)},editTaskDescription:function(){this.getPermission(\"setTaskDescription\")&&(this.addDescriptionShow=!0,this.addDescriptionTextarea=this.taskData.description)},switchChange:function(){var t=this;Object(k.a)({taskId:this.id,status:this.taskData.isMilestone}).then(function(e){t.$emit(\"on-handle\",{type:\"set-milestone\",value:t.taskData.isMilestone,index:t.detailIndex,section:t.detailSection})}).catch(function(){t.$message.error(\"设置里程碑失败\")})},getPermission:function(t){return!this.workId||!!(this.taskData&&this.taskData.authList.project||{})[t]},closeBtn:function(){this.$emit(\"close\")},priorityBtn:function(t,e){var a=this;this.taskData.priority=t.id,Object(k.n)({taskId:this.id,priority:t.id}).then(function(e){a.$emit(\"on-handle\",{type:\"change-priority\",value:t,index:a.detailIndex,section:a.detailSection}),a.priorityVisible=!1}).catch(function(){a.$message.error(\"编辑失败\"),a.taskData.priority=e})},moreDelete:function(){var t=this;this.$confirm(\"确定删除?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){Object(k.h)(t.id).then(function(e){t.$message.success(\"删除成功\"),t.$emit(\"on-handle\",{type:\"delete\",index:t.detailIndex,section:t.detailSection}),t.$emit(\"close\")}).catch(function(){})}).catch(function(){t.$message({type:\"info\",message:\"已取消删除\"})})},moreArchive:function(){var t=this;this.$confirm(\"此操作将归档该任务, 是否继续?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){Object(d.c)(t.id).then(function(e){t.$message.success(\"操作成功\"),t.$emit(\"on-handle\",{type:\"delete\",index:t.detailIndex,section:t.detailSection}),t.$emit(\"close\")}).catch(function(){})}).catch(function(){t.$message({type:\"info\",message:\"已取消删除\"})})},httpRequest:function(t){var e=this;this.$wkUploadFile.upload({file:t.file,params:{batchId:this.taskData.batchId}}).then(function(t){var a=t.res.data||{};e.fileList.push(a),e.$message.success(\"上传成功\")}).catch(function(){})},accessoryDeleteFun:function(t,e){this.fileList.splice(t,1)},subtasksCheckbox:function(t,e){var a=this;e?(this.$set(t,\"checked\",!0),this.subTaskDoneNum++):(this.$set(t,\"checked\",!1),this.subTaskDoneNum--),Object(k.e)({taskId:t.taskId,status:e?5:1}).then(function(t){a.$emit(\"on-handle\",{type:\"change-sub-task\",value:{subdonecount:a.subTaskDoneNum,allcount:a.taskData.childTask.length},index:a.detailIndex,section:a.detailSection})}).catch(function(){a.$message.error(\"子任务标记失败\"),e?(a.$set(t,\"checked\",!1),a.subTaskDoneNum--):(a.$set(t,\"checked\",!0),a.subTaskDoneNum++)})},editOwnerList:function(t,e){var a=this;Object(k.m)({taskId:this.id,ownerUserId:t.map(function(t){return t.userId}).join(\",\")}).then(function(e){a.taskData.ownerUserList=t}).catch(function(){})},deleteOwnerList:function(t,e){var a=this;Object(k.l)({taskId:this.id,userId:t.userId}).then(function(t){a.taskData.ownerUserList.splice(e,1)}).catch(function(){})},mainUserChange:function(t){var e=t.value.length>0?t.value[0]:null;this.submiteMainUser(e)},submiteMainUser:function(t){var e=this;Object(k.k)({taskId:this.id,userId:t?t.userId:\"\"}).then(function(a){t?e.$set(e.taskData,\"mainUser\",t):e.$set(e.taskData,\"mainUser\",null),e.$emit(\"on-handle\",{type:\"change-main-user\",value:t,index:e.detailIndex,section:e.detailSection})}).catch(function(){})},submiteTaskName:function(t){var e=this;Object(k.r)({name:t,taskId:this.id}).then(function(a){e.nameVinput=!1,e.$emit(\"on-handle\",{type:\"change-name\",value:t,index:e.detailIndex,section:e.detailSection}),e.taskData.name=t}).catch(function(){})},deleteTime:function(t){this.taskData[t]=\"\",this.timeChange(t)},timeChange:function(t){var e=this,a={taskId:this.id};a[t]=this.taskData[t],Object(k.q)(a).then(function(a){\"stopTime\"==t&&e.$emit(\"on-handle\",{type:\"change-stop-time\",value:e.taskData[t],index:e.detailIndex,section:e.detailSection})}).catch(function(){})},submiteDescription:function(){var t=this;Object(k.i)({taskId:this.id,description:this.addDescriptionTextarea}).then(function(e){t.addDescriptionShow=!1,t.$set(t.taskData,\"description\",t.addDescriptionTextarea),t.addDescriptionTextarea=\"\"}).catch(function(){})},handleReply:function(t){var e=this;t&&(this.commentsLoading=!0,Object(h.c)({typeId:this.id,type:1,content:l()(t)}).then(function(t){t.data.childCommentList=[],t.data.user={userId:e.userInfo.id,realname:e.userInfo.realname,img:e.userInfo.img},e.$refs.f_reply.commentsTextarea=\"\",e.replyList.push(t.data),e.$emit(\"on-handle\",{type:\"change-comments\",value:\"add\",index:e.detailIndex,section:e.detailSection}),e.commentsLoading=!1}).catch(function(){e.commentsLoading=!1}))},deleteComment:function(t){this.replyList.splice(t,1)},discussDelete:function(t,e,a){var s=this;this.$confirm(\"确定删除?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){Object(h.a)({commentId:t.commentId}).then(function(t){e.splice(a,1),s.$emit(\"on-handle\",{type:\"change-comments\",value:\"delete\",index:s.detailIndex,section:s.detailSection})}).catch(function(){})}).catch(function(){s.$message({type:\"info\",message:\"已取消删除\"})})},checkInfos:function(t,e){var a=this;Object(u.c)({taskId:this.id,customerIds:t.customerIds&&t.customerIds.length?\",\"+t.customerIds.join(\",\")+\",\":\"\",contactsIds:t.contactsIds&&t.contactsIds.length?\",\"+t.contactsIds.join(\",\")+\",\":\"\",businessIds:t.businessIds&&t.businessIds.length?\",\"+t.businessIds.join(\",\")+\",\":\"\",contractIds:t.contractIds&&t.contractIds.length?\",\"+t.contractIds.join(\",\")+\",\":\"\"}).then(function(t){a.$message.success(\"关联成功\"),a.allData=e,a.$emit(\"on-handle\",{type:\"relation-business\",index:a.detailIndex,section:a.detailSection})}).catch(function(){})},unbindRelatedInfo:function(t,e,a){var s=this;this.$confirm(\"确认取消关联?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){var e={taskId:s.taskData.taskId},i=Object(L.t)(s.allData);i[t].splice(a,1);for(var n=[\"customer\",\"contacts\",\"business\",\"contract\"],o=function(t){var a=n[t],s=i[a]||[];e[a+\"Ids\"]=s.map(function(t){return t[a+\"Id\"]}).join(\",\")},c=0;c<n.length;c++)o(c);Object(u.c)(e).then(function(t){s.allData=i,s.$message.success(\"关联取消成功\")}).catch(function(){})}).catch(function(){s.$message.info(\"已取消操作\")})},checkRelatedDetail:function(t,e){this.relatedID=e.key,this.relatedCRMType=t,this.showRelatedDetail=!0},deleteSubTask:function(t){var e=this;this.$confirm(\"此操作将删除该任务, 是否继续?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\",customClass:\"is-particulars\"}).then(function(){Object(k.c)(t.taskId).then(function(a){var s=e.taskData.childTask;for(var i in s)if(s[i].taskId==t.taskId){s.splice(i,1);break}t.checked&&e.subTaskDoneNum--,e.$emit(\"on-handle\",{type:\"change-sub-task\",value:{subdonecount:e.subTaskDoneNum,allcount:e.taskData.childTask.length},index:e.detailIndex,section:e.detailSection}),e.$message.success(\"子任务删除成功\")}).catch(function(){e.$message.error(\"子任务删除失败\")})}).catch(function(){e.$message({type:\"info\",message:\"已取消删除\"})})},editSubTask:function(t){this.subTaskID=t.taskId;var e=this.taskData.childTask;for(var a in e)e[a].taskId==t.taskId?this.$set(e[a],\"showEdit\",!0):this.$set(e[a],\"showEdit\",!1)},handleSubTasksBlock:function(t,e){\"edit\"==t.type?this.$set(e,\"showEdit\",!1):\"add\"==t.type?(this.addSubtasks=!0,t.result,this.$emit(\"on-handle\",{type:\"change-sub-task\",value:{subdonecount:this.subTaskDoneNum,allcount:this.taskData.childTask.length},index:this.detailIndex,section:this.detailSection})):\"cancel\"==t.type&&(e?this.$set(e,\"showEdit\",!1):this.addSubtasks=!0)},deleteTimeTop:function(){var t=this;Object(k.q)({taskId:this.id,stopTime:\"\"}).then(function(e){t.$set(t.taskData,\"stopTime\",\"\"),t.$emit(\"on-handle\",{type:\"stop-time\",index:t.detailIndex,section:t.detailSection})}).catch(function(){})},activateTask:function(){var t=this;this.loading=!0,Object(d.e)(this.taskData.taskId).then(function(e){t.loading=!1,t.$emit(\"on-handle\",{type:\"activate-task\",index:t.detailIndex,section:t.detailSection}),t.closeBtn()}).catch(function(){t.loading=!1})},recoverTask:function(){var t=this;this.loading=!0,Object(p.c)(this.taskData.taskId).then(function(e){t.loading=!1,t.$message.success(\"恢复成功\"),t.$emit(\"on-handle\",{type:\"recover-task\",index:t.detailIndex,section:t.detailSection}),t.closeBtn()}).catch(function(){t.loading=!1})},thoroughDeleteTask:function(){var t=this;this.$confirm(\"确定删除?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.loading=!0,Object(p.a)(t.taskData.taskId).then(function(e){t.loading=!1,t.$emit(\"on-handle\",{type:\"thorough-delete-task\",index:t.detailIndex,section:t.detailSection}),t.closeBtn()}).catch(function(){t.loading=!1})}).catch(function(){t.$message({type:\"info\",message:\"已取消删除\"})})},morkDropdownClick:function(t){this.moreDelete()},hideView:function(){this.$emit(\"close\"),this.$emit(\"hide-view\")},closeOtherReply:function(t){!t&&this.$refs.comment_list&&this.$refs.comment_list.closeReply()}}},$=(a(\"wEl6\"),a(\"KHd+\")),S=Object($.a)(U,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(\"slide-view\",{directives:[{name:\"empty\",rawName:\"v-empty\",value:!t.canShowDetail,expression:\"!canShowDetail\"}],ref:\"sideView\",staticClass:\"d-view\",attrs:{\"no-listener-class\":t.noListenerClass,\"body-style\":{padding:0,height:\"100%\"},\"xs-empty-icon\":\"nopermission\",\"xs-empty-text\":\"暂无权限\"},on:{afterEnter:t.viewAfterEnter,close:t.hideView}},[null!==t.loading?s(\"flexbox\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.loading,expression:\"loading\"}],staticClass:\"main\",attrs:{direction:\"column\",align:\"stretch\"}},[t.taskData?s(\"div\",{staticClass:\"main__hd task-hd\"},[s(\"flexbox\",{staticClass:\"task-hd__top\",attrs:{justify:\"space-between\"}},[t.taskData.createUser?s(\"span\",{staticClass:\"task-hd__top--create\"},[t._v(t._s(t.taskData.createUser.realname)+\" 创建于 \"+t._s(t.taskData.createTime))]):t._e(),t._v(\" \"),s(\"div\",[t.isArchive?s(\"span\",{staticClass:\"task-hd__top--info\"},[t._v(\"该任务已于 \"+t._s(t.taskData.archiveTime)+\" 被归档\")]):t._e(),t._v(\" \"),t.isArchive?s(\"el-button\",{staticClass:\"xr-btn--primary\",attrs:{icon:\"wk wk-activation\",type:\"primary\"},on:{click:t.activateTask}},[t._v(\"激活\")]):t._e(),t._v(\" \"),t.isRecycle?s(\"span\",{staticClass:\"task-hd__top--info\"},[t._v(\"该任务已于 \"+t._s(t.taskData.hiddenTime)+\" 被放入回收站\")]):t._e(),t._v(\" \"),t.isRecycle&&t.getPermission(\"restoreTask\")?s(\"el-button\",{staticClass:\"xr-btn--primary\",attrs:{icon:\"wk wk-activation\",type:\"primary\"},on:{click:t.recoverTask}},[t._v(\"恢复\")]):t._e(),t._v(\" \"),t.isRecycle&&t.getPermission(\"cleanTask\")?s(\"el-button\",{staticClass:\"xr-btn--red\",attrs:{icon:\"el-icon-delete-solid\",type:\"primary\"},on:{click:t.thoroughDeleteTask}},[t._v(\"彻底删除\")]):t._e(),t._v(\" \"),t.showArchiveBtn&&t.getPermission(\"archiveTask\")?s(\"el-button\",{staticClass:\"xr-btn--green\",attrs:{icon:\"wk wk-archive\",type:\"primary\"},on:{click:t.moreArchive}},[t._v(\"归档\")]):t._e(),t._v(\" \"),!t.isRecycle&&t.getPermission(\"deleteTask\")?s(\"el-dropdown\",{attrs:{trigger:\"click\"},on:{command:t.morkDropdownClick}},[s(\"el-button\",{attrs:{icon:\"el-icon-more\"}}),t._v(\" \"),s(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},[s(\"el-dropdown-item\",{attrs:{icon:t._f(\"wkIconPre\")(\"delete\"),command:\"delete\"}},[t._v(\"删除\")])],1)],1):t._e()],1)]),t._v(\" \"),s(\"flexbox\",{staticClass:\"task-hd__middle\",attrs:{align:\"stretch\"}},[s(\"el-checkbox\",{attrs:{disabled:!t.getPermission(\"setTaskStatus\")},on:{change:t.completeMainTask},model:{value:t.taskData.checked,callback:function(e){t.$set(t.taskData,\"checked\",e)},expression:\"taskData.checked\"}}),t._v(\" \"),t.nameVinput?s(\"div\",{staticClass:\"show-input\"},[s(\"el-input\",{attrs:{maxlength:100,size:\"medium\"},model:{value:t.taskDataName,callback:function(e){t.taskDataName=e},expression:\"taskDataName\"}}),t._v(\" \"),s(\"div\",{staticClass:\"btn-box\"},[s(\"el-button\",{attrs:{type:\"primary\",size:\"mini\"},on:{click:function(e){t.submiteTaskName(t.taskDataName)}}},[t._v(\"保 存\")]),t._v(\" \"),s(\"el-button\",{attrs:{size:\"mini\"},on:{click:function(e){t.nameVinput=!1}}},[t._v(\"取 消\")])],1)],1):s(\"el-tooltip\",{attrs:{content:t.taskData.name,effect:\"dark\",placement:\"top\"}},[s(\"div\",{class:[\"task-name\",{\"is-checked\":t.taskData.checked}],on:{click:t.editTaskName}},[t._v(t._s(t.taskData.name))])])],1),t._v(\" \"),s(\"flexbox\",{staticClass:\"task-hd__bottom\"},[s(\"flexbox-item\",{staticClass:\"priority\",attrs:{span:.125}},[s(\"flexbox\",{nativeOn:{click:function(e){t.priorityVisible=!0}}},[s(\"el-popover\",{attrs:{disabled:!t.getPermission(\"setTaskPriority\"),\"popper-class\":\"no-padding-popover\",placement:\"bottom\",trigger:\"click\"},model:{value:t.priorityVisible,callback:function(e){t.priorityVisible=e},expression:\"priorityVisible\"}},[s(\"flexbox\",{staticClass:\"priority-select\"},t._l(t.priorityList,function(e,a){return s(\"div\",{key:a,staticClass:\"priority-select-item\",on:{click:function(a){t.priorityBtn(e,t.taskData.priority)}}},[s(\"span\",{staticClass:\"priority--icon\",style:{backgroundColor:e.color}},[t._v(t._s(e.label))])])})),t._v(\" \"),s(\"span\",{staticClass:\"priority--icon\",style:{backgroundColor:t.priority.color},attrs:{slot:\"reference\"},slot:\"reference\"},[t._v(t._s(t.priority.label))])],1),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd\"},[s(\"div\",{staticClass:\"head-btn__bd--des\"},[t._v(\"优先级\")])])],1)],1),t._v(\" \"),s(\"flexbox-item\",{staticClass:\"label\",attrs:{span:.125}},[s(\"flexbox\",{staticClass:\"head-btn\"},[s(\"div\",{staticClass:\"head-btn__bd\"},[s(\"div\",{staticClass:\"head-btn__bd--des\"},[t._v(\"里程碑\")])]),t._v(\" \"),s(\"el-switch\",{attrs:{\"active-value\":1,\"inactive-value\":0},on:{change:function(e){t.switchChange()}},model:{value:t.taskData.isMilestone,callback:function(e){t.$set(t.taskData,\"isMilestone\",e)},expression:\"taskData.isMilestone\"}})],1)],1),t._v(\" \"),s(\"flexbox-item\",[s(\"xh-user-cell\",{staticStyle:{width:\"100%\"},attrs:{value:t.taskData.mainUser?[t.taskData.mainUser]:[],\"info-request\":t.ownerListRequest,\"info-params\":t.ownerListParams,disabled:!t.getPermission(\"setTaskMainUser\"),placement:\"top\",radio:\"\"},on:{\"value-change\":t.mainUserChange}},[s(\"flexbox\",{staticClass:\"head-btn\",attrs:{slot:\"reference\"},slot:\"reference\"},[t.taskData.mainUser?s(\"xr-avatar\",{staticClass:\"user-img\",attrs:{name:t.taskData.mainUser?t.taskData.mainUser.realname:\"\",size:32,src:t.taskData.mainUser?t.taskData.mainUser.img:\"\"}}):s(\"i\",{staticClass:\"wk wk-l-plus head-btn__icon is-null\"}),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd\"},[t.taskData.mainUser?s(\"div\",{staticClass:\"head-btn__bd--title\"},[t._v(t._s(t.taskData.mainUser.realname))]):t._e(),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd--des\"},[t._v(\"负责人\")])]),t._v(\" \"),s(\"i\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.taskData.mainUser&&t.getPermission(\"setTaskMainUser\"),expression:\"taskData.mainUser && getPermission('setTaskMainUser')\"}],staticClass:\"el-icon-close head-btn__close\",on:{click:function(e){t.submiteMainUser(null)}}})],1)],1)],1),t._v(\" \"),s(\"flexbox-item\",[s(\"flexbox\",{staticClass:\"head-btn\"},[s(\"i\",{staticClass:\"wk wk-l-time head-btn__icon\",class:[t.taskData.startTime?\"is-valve\":\"is-null\"]}),t._v(\" \"),s(\"el-date-picker\",{attrs:{clearable:!1,disabled:!t.getPermission(\"setTaskTime\"),\"picker-options\":t.startTimeOptions,type:\"date\",\"value-format\":\"yyyy-MM-dd\"},on:{change:function(e){t.timeChange(\"startTime\")}},model:{value:t.taskData.startTime,callback:function(e){t.$set(t.taskData,\"startTime\",e)},expression:\"taskData.startTime\"}}),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd\"},[t.taskData.startTime?s(\"div\",{staticClass:\"head-btn__bd--title\"},[t._v(t._s(t._f(\"moment\")(t.taskData.startTime,\"YYYY年MM月DD日\")))]):t._e(),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd--des\"},[t._v(\"开始时间\")])]),t._v(\" \"),s(\"i\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.taskData.startTime,expression:\"taskData.startTime\"}],staticClass:\"el-icon-close head-btn__close\",on:{click:function(e){t.deleteTime(\"startTime\")}}})],1)],1),t._v(\" \"),s(\"flexbox-item\",[s(\"flexbox\",{staticClass:\"head-btn\"},[s(\"i\",{staticClass:\"wk wk-l-minus head-btn__icon\",class:[t.taskData.stopTime?\"is-valve\":\"is-null\"]}),t._v(\" \"),s(\"el-date-picker\",{attrs:{clearable:!1,disabled:!t.getPermission(\"setTaskTime\"),\"picker-options\":t.stopTimeOptions,type:\"date\",\"value-format\":\"yyyy-MM-dd\"},on:{change:function(e){t.timeChange(\"stopTime\")}},model:{value:t.taskData.stopTime,callback:function(e){t.$set(t.taskData,\"stopTime\",e)},expression:\"taskData.stopTime\"}}),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd\"},[t.taskData.stopTime?s(\"div\",{staticClass:\"head-btn__bd--title\"},[t._v(t._s(t._f(\"moment\")(t.taskData.stopTime,\"YYYY年MM月DD日\")))]):t._e(),t._v(\" \"),s(\"div\",{staticClass:\"head-btn__bd--des\"},[t._v(\"结束时间\")])]),t._v(\" \"),s(\"i\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.taskData.stopTime,expression:\"taskData.stopTime\"}],staticClass:\"el-icon-close head-btn__close\",on:{click:function(e){t.deleteTime(\"stopTime\")}}})],1)],1)],1)],1):t._e(),t._v(\" \"),t.taskData?s(\"flexbox\",{staticClass:\"main__bd\",attrs:{align:\"stretch\"}},[s(\"div\",{staticClass:\"main__bd--left\"},[s(\"flexbox\",[s(\"flexbox-item\",{staticClass:\"participant\"},[s(\"div\",{staticClass:\"participant-title\"},[t._v(\"参与人\")]),t._v(\" \"),s(\"flexbox\",{staticClass:\"participant-bd\",attrs:{wrap:\"wrap\"}},[t._l(t.taskData.ownerUserList,function(e,i){return s(\"span\",{key:i,staticClass:\"owner-list\"},[s(\"el-tooltip\",{attrs:{placement:\"bottom\",effect:\"light\",\"popper-class\":\"tooltip-change-border\"}},[s(\"div\",{attrs:{slot:\"content\"},slot:\"content\"},[s(\"span\",[t._v(t._s(e.realname))])]),t._v(\" \"),s(\"xr-avatar\",{staticClass:\"user-img\",attrs:{name:e.realname,size:32,src:e.img}})],1),t._v(\" \"),t.getPermission(\"setTaskOwnerUser\")?s(\"img\",{staticClass:\"el-icon-close\",attrs:{onerror:'this.src=\"'+a(\"Tww3\")+'\"',src:a(\"cEue\")},on:{click:function(a){t.deleteOwnerList(e,i)}}}):t._e()],1)}),t._v(\" \"),t.getPermission(\"setTaskOwnerUser\")?s(\"members-dep\",{attrs:{\"close-dep\":!0,\"content-block\":!1,\"user-checked-data\":t.taskData.ownerUserList,\"user-request\":t.ownerListRequest,\"user-params\":t.ownerListParams},on:{popoverSubmit:t.editOwnerList}},[s(\"i\",{staticClass:\"wk wk-l-plus participant-add\",attrs:{slot:\"membersDep\"},slot:\"membersDep\"})]):t._e()],2)],1),t._v(\" \"),s(\"flexbox-item\",{staticClass:\"label\"},[s(\"div\",{staticClass:\"label-title\"},[t._v(\"标签\")]),t._v(\" \"),t._l(t.labelList,function(e,a){return s(\"span\",{key:a,staticClass:\"item-color\",style:{background:e.color?e.color:\"#ccc\"}},[t._v(\"\\n              \"+t._s(e.labelName)+\"\\n            \")])}),t._v(\" \"),t.getPermission(\"setTaskLabel\")?s(\"div\",{staticClass:\"add-tag\"},[s(\"tag-index\",{attrs:{placement:\"right\",\"task-data\":t.taskData}},[s(\"span\",{staticClass:\"add-btn\",attrs:{slot:\"editIndex\"},slot:\"editIndex\"},[s(\"i\",{staticClass:\"wk wk-l-plus\"}),t._v(\" \"),s(\"span\",{staticClass:\"label\"},[t._v(\"标签\")])])])],1):t._e()],2)],1),t._v(\" \"),s(\"div\",{staticClass:\"secitons\"},[s(\"div\",{staticClass:\"section\"},[s(\"div\",{staticClass:\"section__hd\"},[s(\"i\",{staticClass:\"wk wk-write\"}),t._v(\" \"),s(\"span\",[t._v(\"描述\")])]),t._v(\" \"),s(\"div\",{staticClass:\"section__bd description\"},[s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.addDescriptionShow,expression:\"!addDescriptionShow\"}]},[t.taskData.description?s(\"div\",{staticClass:\"description-content\",on:{click:t.editTaskDescription}},[t._v(t._s(t.taskData.description))]):s(\"div\",{staticClass:\"description-empty\"},[s(\"span\",{staticClass:\"color-label\"},[t._v(\"暂无描述\")]),t._v(\" \"),t.getPermission(\"setTaskDescription\")?s(\"span\",{staticClass:\"add-btn\",on:{click:function(e){t.addDescriptionShow=!0}}},[s(\"i\",{staticClass:\"wk wk-l-plus\"}),t._v(\" \"),s(\"span\",{staticClass:\"label\"},[t._v(\"描述\")])]):t._e()])]),t._v(\" \"),s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.addDescriptionShow,expression:\"addDescriptionShow\"}]},[s(\"el-input\",{attrs:{autosize:{minRows:2},maxlength:2e3,\"show-word-limit\":\"\",type:\"textarea\",placeholder:\"请输入内容\"},model:{value:t.addDescriptionTextarea,callback:function(e){t.addDescriptionTextarea=e},expression:\"addDescriptionTextarea\"}}),t._v(\" \"),s(\"div\",{staticClass:\"btn-box\"},[s(\"el-button\",{attrs:{type:\"primary\",size:\"mini\"},on:{click:t.submiteDescription}},[t._v(\"保 存\")]),t._v(\" \"),s(\"el-button\",{attrs:{type:\"text\",size:\"mini\"},on:{click:function(e){t.addDescriptionTextarea=\"\",t.addDescriptionShow=!1}}},[t._v(\"取 消\")])],1)],1)])]),t._v(\" \"),s(\"div\",{staticClass:\"section\"},[s(\"div\",{staticClass:\"section__hd\"},[s(\"i\",{staticClass:\"wukong wukong-relevance\"}),t._v(\" \"),s(\"span\",[t._v(\"相关信息\")])]),t._v(\" \"),s(\"div\",{staticClass:\"section__bd\"},[s(\"related-business\",{attrs:{\"margin-left\":\"0\",\"all-data\":t.allData,\"show-foot\":t.getPermission(\"saveTaskRelation\"),\"show-add\":t.getPermission(\"saveTaskRelation\")},on:{checkRelatedDetail:t.checkRelatedDetail,checkInfos:t.checkInfos,unbind:t.unbindRelatedInfo}})],1)]),t._v(\" \"),s(\"div\",{staticClass:\"section\"},[s(\"div\",{staticClass:\"section__hd\"},[s(\"i\",{staticClass:\"wukong wukong-sub-task\"}),t._v(\" \"),s(\"span\",[t._v(\"子任务(\"+t._s(t.subTaskDoneNum)+\"/\"+t._s(t.taskData.childTask.length)+\")\")])]),t._v(\" \"),s(\"div\",{staticClass:\"section__bd\"},[0==t.taskData.pid?s(\"div\",[s(\"div\",[0!=t.taskData.childTask.length?[s(\"el-progress\",{attrs:{percentage:t.subTaskProgress,\"stroke-width\":10}})]:[s(\"el-progress\",{attrs:{percentage:0}})]],2),t._v(\" \"),0!=t.taskData.childTask.length?t._l(t.taskData.childTask,function(e,a){return s(\"div\",{key:a},[e.showEdit?s(\"sub-task\",{attrs:{\"sub-task-com\":\"edit\",time:e.stopTime,\"sub-data\":e,text:e.name,\"task-id\":t.subTaskID,\"checkbox-data\":e.checked,\"task-data\":t.taskData},on:{\"on-handle\":function(a){t.handleSubTasksBlock(a,e)}}}):s(\"flexbox\",{staticClass:\"sub-task\"},[s(\"div\",{on:{click:function(t){t.stopPropagation()}}},[s(\"el-checkbox\",{attrs:{disabled:!t.getPermission(\"setChildTaskStatus\")},on:{change:function(a){t.subtasksCheckbox(e,a)}},model:{value:e.checked,callback:function(a){t.$set(e,\"checked\",a)},expression:\"item.checked\"}})],1),t._v(\" \"),s(\"div\",{staticClass:\"sub-task__bd text-one-line\",class:{\"is-checked\":e.checked}},[t._v(\"\\n                        \"+t._s(e.name)+\"\\n                      \")]),t._v(\" \"),s(\"div\",{staticClass:\"edit-del-box\"},[t.getPermission(\"updateChildTask\")?s(\"span\",{staticClass:\"xr-text-btn primary\",on:{click:function(a){t.editSubTask(e)}}},[t._v(\"编辑\")]):t._e(),t._v(\" \"),t.getPermission(\"deleteChildTask\")?s(\"span\",{staticClass:\"xr-text-btn delete\",on:{click:function(a){t.deleteSubTask(e)}}},[t._v(\"删除\")]):t._e()]),t._v(\" \"),e.stopTime?s(\"div\",{staticClass:\"bg-color task-bg-color\"},[t._v(t._s(t._f(\"moment\")(e.stopTime,\"YYYY-MM-DD\"))+\" 截止\")]):t._e(),t._v(\" \"),e.mainUser?s(\"xr-avatar\",{staticClass:\"user-img\",attrs:{name:e.mainUser.realname,size:25,src:e.mainUser.img}}):t._e()],1)],1)}):t._e(),t._v(\" \"),t.getPermission(\"addChildTask\")?[t.addSubtasks?s(\"div\",[s(\"span\",{staticClass:\"add-btn\",on:{click:function(e){t.addSubtasks=!1}}},[s(\"i\",{staticClass:\"wk wk-l-plus\"}),t._v(\" \"),s(\"span\",{staticClass:\"label\"},[t._v(\"子任务\")])])]):s(\"sub-task\",{attrs:{\"sub-task-com\":\"new\",\"task-data\":t.taskData},on:{\"on-handle\":t.handleSubTasksBlock}})]:t._e()],2):t._e()])]),t._v(\" \"),s(\"div\",{staticClass:\"section\"},[s(\"div\",{staticClass:\"section__hd\"},[s(\"i\",{staticClass:\"wukong wukong-file\"}),t._v(\" \"),s(\"span\",[t._v(\"附件\")]),t._v(\" \"),t.fileList.length?s(\"span\",[t._v(\"(\"+t._s(t.fileList.length)+\")\")]):t._e()]),t._v(\" \"),s(\"div\",{staticClass:\"section__bd\"},[t._l(t.fileList,function(e,a){return s(\"file-cell\",{key:a,attrs:{data:e,list:t.fileList,\"cell-index\":a,\"module-id\":t.id,\"show-delete\":t.getPermission(\"deleteTaskFile\")},on:{delete:t.accessoryDeleteFun}})}),t._v(\" \"),t.getPermission(\"uploadTaskFile\")?s(\"el-upload\",{staticClass:\"upload-file\",attrs:{\"http-request\":t.httpRequest,action:\"https://jsonplaceholder.typicode.com/posts/\",multiple:\"\",\"list-type\":\"picture\"}},[s(\"span\",{staticClass:\"add-btn\"},[s(\"i\",{staticClass:\"wk wk-l-plus\"}),t._v(\" \"),s(\"span\",{staticClass:\"label\"},[t._v(\"附件\")])])]):t._e()],2)])])],1),t._v(\" \"),s(\"div\",{staticClass:\"main__bd--right\"},[s(\"el-tabs\",{staticClass:\"d-container-bd--right\",attrs:{value:\"comment\",type:\"border-card\"}},[s(\"el-tab-pane\",{attrs:{label:\"评论\",name:\"comment\",lazy:\"\"}},[s(\"flexbox\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.commentsLoading,expression:\"commentsLoading\"}],staticClass:\"comment-cells\",attrs:{direction:\"column\",align:\"stretch\"}},[s(\"comment-list\",{ref:\"comment_list\",attrs:{id:t.taskData.taskId,list:t.replyList,type:\"1\"},on:{delete:t.deleteComment,\"close-other-reply\":function(e){t.$refs.f_reply.toggleFocus(!0)}}}),t._v(\" \"),s(\"reply-comment\",{ref:\"f_reply\",on:{toggle:t.closeOtherReply,reply:t.handleReply}})],1)],1),t._v(\" \"),s(\"el-tab-pane\",{attrs:{label:\"活动\",name:\"activity\",lazy:\"\"}},[s(\"div\",{staticClass:\"activity-cells\"},t._l(t.activityList,function(e,a){return s(\"flexbox\",{key:a,staticClass:\"activity-cell\",attrs:{align:\"stretch\"}},[s(\"xr-avatar\",{staticClass:\"user-img\",attrs:{name:e.realname,size:26,src:e.img}}),t._v(\" \"),s(\"div\",{staticClass:\"activity-cell__bd\"},[s(\"div\",{staticClass:\"activity-info\"},[s(\"span\",{staticClass:\"activity-info--name\"},[t._v(t._s(e.realname))]),t._v(\" \"),s(\"span\",{staticClass:\"activity-info--time\"},[t._v(t._s(e.createTime))])]),t._v(\" \"),s(\"div\",{staticClass:\"activity-content\"},[t._v(t._s(e.content))])])],1)}))])],1)],1)]):t._e()],1):t._e(),t._v(\" \"),s(\"c-r-m-full-screen-detail\",{attrs:{visible:t.showRelatedDetail,\"crm-type\":t.relatedCRMType,id:t.relatedID},on:{\"update:visible\":function(e){t.showRelatedDetail=e}}})],1)},[],!1,null,\"842ab9ec\",null);S.options.__file=\"TaskDetail.vue\";e.default=S.exports},qEca:function(t,e,a){\"use strict\";var s=a(\"wp1W\");a.n(s).a},wEl6:function(t,e,a){\"use strict\";var s=a(\"cFwc\");a.n(s).a},wp1W:function(t,e,a){},z5u8:function(t,e,a){\"use strict\";a.r(e);var s=a(\"gDS+\"),i=a.n(s),n=a(\"QbLZ\"),o=a.n(n),c=a(\"Flj7\"),r=a(\"0hym\"),l=a(\"LWkM\"),d=a(\"L2JU\"),u={components:{XhUser:r.a},props:{taskData:{type:Object,default:function(){return{}}},text:String,time:[String,Number],subData:Object,subTaskCom:{type:String,default:\"\"},taskId:[Number,String],checkboxData:{type:Boolean,default:!1}},data:function(){return{subtasksDate:\"\",xhUserData:[],isRequesting:!1,subtasksTextarea:\"\",showUserPopover:!1}},computed:o()({ownerListRequest:function(){return this.workId?l.t:null},ownerListParams:function(){return this.workId?{workId:this.workId}:null},workId:function(){return this.taskData.workId},isChangeUser:function(){var t=this.subData.mainUser?[this.subData.mainUser]:[];return this.xhUserData.length!=t.length||!(!this.xhUserData.length||this.xhUserData[0].userId==this.subData.mainUser.userId)}},Object(d.b)([\"userInfo\"])),watch:{},created:function(){\"edit\"==this.subTaskCom&&(this.subtasksTextarea=this.text?this.text:\"\",this.subtasksDate=this.time,\"{}\"!==i()(this.subData)?this.subData.mainUser&&(this.xhUserData=[this.subData.mainUser]):this.xhUserData=[])},methods:{subtasksSubmit:function(t){var e=this;this.subtasksTextarea=this.subtasksTextarea.split(/[\\n]/).join(\"\"),this.subtasksTextarea&&!this.isRequesting?(this.isRequesting=!0,\"new\"==this.subTaskCom?Object(c.b)({pid:this.taskData.taskId,name:this.subtasksTextarea,stopTime:this.subtasksDate,mainUserId:0!=this.xhUserData.length?this.xhUserData[0].userId:\"\"}).then(function(t){e.taskData.childTask.push({name:e.subtasksTextarea,stopTime:e.subtasksDate,taskId:t.data.taskId,mainUser:e.xhUserData.length>0?e.xhUserData[0]:e.userInfo}),e.$message.success(\"子任务创建成功\"),e.subtasksTextarea=\"\",e.subtasksDate=\"\",e.isRequesting=!1,e.$emit(\"on-handle\",{type:\"add\",result:\"success\"})}).catch(function(){e.$emit(\"on-handle\",{type:\"add\",result:\"error\"}),e.$message.error(\"子任务创建失败\"),e.isRequesting=!0}):\"edit\"==this.subTaskCom&&(1==this.isChangeUser||this.text!=this.subtasksTextarea||this.subtasksDate!=this.time?Object(c.d)({taskId:this.taskId,stopTime:this.subtasksDate,mainUserId:this.xhUserData.length>0?this.xhUserData[0].userId:\"\",name:this.subtasksTextarea}).then(function(t){var a=e.taskData.childTask;for(var s in a)if(a[s].taskId==e.taskId){var i=a[s];i.name=e.subtasksTextarea,i.stopTime=e.subtasksDate,i.mainUser=e.xhUserData.length>0?e.xhUserData[0]:null,a.splice(s,1,i);break}e.isRequesting=!1,e.$emit(\"on-handle\",{type:\"edit\",result:\"success\"}),e.$message.success(\"子任务编辑成功\")}).catch(function(){e.$emit(\"on-handle\",{type:\"edit\",result:\"error\"}),e.$message.error(\"子任务编辑失败\"),e.isRequesting=!1}):this.$emit(\"on-handle\",{type:\"cancel\"}))):this.$emit(\"on-handle\",{type:\"cancel\"})},xhUserCheckout:function(t){this.xhUserData=t,this.showUserPopover=!1},subtasksDateFun:function(){this.$refs.subtasksDate.change()}}},h=(a(\"qEca\"),a(\"KHd+\")),k=Object(h.a)(u,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"task-sub\"},[a(\"div\",{directives:[{name:\"clickoutside\",rawName:\"v-clickoutside\",value:t.subtasksSubmit,expression:\"subtasksSubmit\"}],staticClass:\"subtasks-content\"},[a(\"div\",{staticClass:\"checkbox-box subtasks-box\"},[a(\"el-checkbox\",{attrs:{disabled:\"\"},model:{value:t.checkboxData,callback:function(e){t.checkboxData=e},expression:\"checkboxData\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"subtasks-content-box\"},[a(\"el-input\",{attrs:{maxlength:50,type:\"textarea\",autosize:\"\",placeholder:\"请输入内容\"},nativeOn:{keyup:function(e){return\"button\"in e||!t._k(e.keyCode,\"enter\",13,e.key,\"Enter\")?t.subtasksSubmit(e):null}},model:{value:t.subtasksTextarea,callback:function(e){t.subtasksTextarea=e},expression:\"subtasksTextarea\"}})],1),t._v(\" \"),a(\"flexbox\",{staticClass:\"subtasks-content-png\"},[a(\"div\",{staticClass:\"time\"},[a(\"el-date-picker\",{ref:\"subtasksDate\",style:{width:t.subtasksDate?\"54px\":\"28px\"},attrs:{type:\"date\",format:\"yyyy 年 MM 月 dd 日\",\"value-format\":\"yyyy-MM-dd\",placeholder:\"选择日期\"},model:{value:t.subtasksDate,callback:function(e){t.subtasksDate=e},expression:\"subtasksDate\"}}),t._v(\" \"),t.subtasksDate?a(\"span\",{staticClass:\"bg-color\"},[t._v(t._s(t._f(\"moment\")(t.subtasksDate,\"YYYY-MM-DD\")))]):a(\"i\",{staticClass:\"wukong wukong-time-task\",on:{click:t.subtasksDateFun}})],1),t._v(\" \"),a(\"el-popover\",{attrs:{placement:\"bottom-end\",width:\"280\",\"popper-class\":\"no-padding-popover\",trigger:\"click\"},model:{value:t.showUserPopover,callback:function(e){t.showUserPopover=e},expression:\"showUserPopover\"}},[a(\"xh-user\",{ref:\"xhuser\",attrs:{\"info-request\":t.ownerListRequest,\"info-params\":t.ownerListParams,\"selected-data\":t.xhUserData,radio:\"\"},on:{changeCheckout:t.xhUserCheckout}}),t._v(\" \"),a(\"div\",{staticClass:\"select-box\",attrs:{slot:\"reference\"},slot:\"reference\"},[t.xhUserData&&t.xhUserData.length?t._l(t.xhUserData,function(e,s){return a(\"span\",{key:s},[a(\"el-tooltip\",{attrs:{placement:\"bottom\",effect:\"light\",\"popper-class\":\"tooltip-change-border\"}},[a(\"div\",{attrs:{slot:\"content\"},slot:\"content\"},[a(\"span\",{on:{click:function(e){t.showUserPopover=!0}}},[t._v(t._s(e.realname))])]),t._v(\" \"),a(\"xr-avatar\",{attrs:{name:e.realname,size:24,src:e.img}})],1)],1)}):a(\"i\",{staticClass:\"wukong wukong-user\"})],2)],1)],1)],1)])},[],!1,null,\"69ac83d6\",null);k.options.__file=\"SubTask.vue\";e.default=k.exports}}]);","extractedComments":[]}